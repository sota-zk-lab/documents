# Annotation

## Annotation

The annotation file describes the interaction between the Prover and Verifier.
It is generated by the stone-prover using the `--generated_annotation` option.

For better understanding, we recommend reading the STARK workflow [here](./stark_engine.md).
The annotation `P->V[x:y]` indicates that the Prover sends a value to the Verifier.
This value is located from byte $x$ to byte $y$ in proof hex.
Below is an explanation of each line in the annotation file:

```bash
// Prover sends the base trace commitment value
"P->V[0:32]: /cpu air/STARK/Original/Commit on Trace: Commitment: 
Hash(0xee052d9dc58fd7361a57a74ca1be8b204a62ba2d000000000000000000000000)"
```

```bash
// Verifier, after receiving the base trace commitment, sends back AIR
// challenges for constructing extension columns. 
// The element[0] is z, and element[1] is alpha, which are used for computing
// the accumulated product of memory pages.
"V->P: /cpu air/STARK/Interaction: Interaction element #0: 
Field Element(0xe5609aae9ef4b5d444a1070ddf6002bda3b149d84e471669dff4e9fe23e4e7)"
```

```bash
// Prover sends the extension trace commitment value
"P->V[32:64]: /cpu air/STARK/Interaction/Commit on Trace: Commitment: 
Hash(0xc801f646741df9a1cf86021c33b40f21016dfcb9000000000000000000000000)"
```

```bash
// Verifier sends constraint polynomial random element for constructing
// composition polynomial (the COMPOSITION_ALPHA value in SHARP verifier)
"V->P: /cpu air/STARK/Original: Constraint polynomial random element: 
Field Element(0x51a7f3a3637d259291f0fb2400d56471b0b5886fdb40399df9daf15672a4311)"
```

```bash
// Prover sends the composition trace commitment value
"P->V[64:96]: /cpu air/STARK/Out Of Domain Sampling/Commit on Trace: 
Commitment: Hash(0xc9b2cd705632b8c0f1699a1a571b6fd7b2aaec06000000000000000000000000)"
```

```bash
// Verifier sends the OOD evaluation point
"V->P: /cpu air/STARK/Out Of Domain Sampling/OODS values: Evaluation point: 
Field Element(0x95e957960fda92b86863163bea89191ba862f6ea9cded6e2a243dc00ce2b50)"
```

```bash
// Prover sends the OOD sampling values, including masks and H1, H2,... (later 
// converted to Montgomery form in the proof)
"P->V[96:128]: /cpu air/STARK/Out Of Domain Sampling/OODS values: 0: 
Field Element(0x2b04a169c636c9f8b238d14a9f60e2a51daf17e08b3117621ae7a2c9d5a6c52)"
```

```bash
// Verifier sends a random element for DEEP method (the OODS_ALPHA value in 
// the SHARP verifier)
"V->P: /cpu air/STARK/Out Of Domain Sampling: Constraint polynomial random element: 
Field Element(0x57a687bd3c4d0a0fb48102d250cfad2cece5d5ab0f8d07de9b86346a1251d8b)"
```

```bash
// Prover commits root of each layer in FRI
"P->V[8832:8864]: /cpu air/STARK/FRI/Commitment/Layer 1: Commitment: 
Hash(0x2d3e54e5efb0116e480ecb1475ca87b996c08421000000000000000000000000)"  
// Verifier sends the evaluation point for this Layer in FRI
"V->P: /cpu air/STARK/FRI/Commitment/Layer 2: Evaluation point: 
Field Element(0x915cd99983f0d3be5becf002ec4e16133875105b5728de8741ccda7b508cc9)"
```

```bash
// Prover commits the coefficients of the last layer in FRI
"P->V[9088:10112]: /cpu air/STARK/FRI/Commitment/Last Layer: Coefficients: 
Field Elements(0x74d41c7e9f181d27e1bb9628f16ca5b0fbdf2fab5aea87c220570b6bda0271f, 
...
0x39a40db9f31acd0bcd3b44227ef3aeabe6e1c84a4ae66f50ab9c524be12cf14)"

```

```bash
// Prover sends the Proof of Work nonce
"P->V[10112:10120]: /cpu air/STARK/FRI/Proof of Work: POW: Data(0x77a69c66)"
```

```bash
// Verifier sends the FRI queue positions
"V->P: /cpu air/STARK/FRI/QueryIndices: 0: Number(28768612)"
```

```bash
// For each position given by the verifier, the prover sends the claimed value 
// of each column in the base trace (later used to construct the DEEP evaluation).
"P->V[10120:10152]: /cpu air/STARK/FRI/Decommitment/Layer 0/Virtual Oracle/Trace 0: 
Row 3338105, Column 0: Field Element(0x71e1515b1c419d54c79170501d124b687228993fae10f9e4bcd4c2a581b202)"

// Prover sends the Merkle view for the claimed values
"P->V[15304:15336]: /cpu air/STARK/FRI/Decommitment/Layer 0/Virtual Oracle/Trace 0: 
For node 36892536: Hash(0x6742829510ef4e7512fe1ff985578b36564f71bd000000000000000000000000)"

// For each position given by the verifier, the prover sends the claimed value 
// of each column in the extension trace (later used to construct the DEEP evaluation).
"P->V[26952:26984]: /cpu air/STARK/FRI/Decommitment/Layer 0/Virtual Oracle/Trace 1: 
Row 3338105, Column 0: Field Element(0x6d57085424cea1b4339323629e0a153277b501d50538bdbccce35f27ab3e980)"

// Prover sends the Merkle view for the claimed values
"P->V[27528:27560]: /cpu air/STARK/FRI/Decommitment/Layer 0/Virtual Oracle/Trace 1: 
To complete packages, element #3338104: Data(0x5fefc6ac7859869b87575a5d738a8803226d0823c4ebc2e78713abac5cc99a6)"

// For each position given by the verifier, the prover sends the claimed value 
// of each column in the composition trace (later used to construct the DEEP evaluation).
"P->V[39176:39208]: /cpu air/STARK/FRI/Decommitment/Layer 0/Virtual Oracle/Trace 2: 
Row 3338105, Column 0: Field Element(0x787563ac5fdd6d69ebeeb10c847a32806ca5a51c7546e267c409b6e17ba604b)"

// Prover sends the Merkle view for the claimed values
"P->V[40328:40360]: /cpu air/STARK/FRI/Decommitment/Layer 0/Virtual Oracle/Trace 2: 
For node 36892536: Hash(0x4dffb14c253f4bedf978dce54406b5097bf715d1000000000000000000000000)"
```

```bash
// Prover sends the neighboring values for each FRI layer
"P->V[51976:52008]: /cpu air/STARK/FRI/Decommitment/Layer 1: Row 834526, 
Column 0: Field Element(0x7bc34f6dfbda243d1cb945182659ec74d7a3a7e03d4f6cc4daafbc45203c992)"

// Prover sends the inner node value for each FRI layer
"P->V[53704:53736]: /cpu air/STARK/FRI/Decommitment/Layer 1: For node 9223135: 
Hash(0x3db2cee9bd35b4190a3f180f92d80243b30bad30000000000000000000000000)"
```

## Extra Output

The extra output file generated by Stone-prover verification process. It includes
extra data necessary for generating split proofs.

It includes some information:

```bash
// Value of MerkleQueue in the base trace. It is computed by hashing 8 column 
// values sent by the prover
"/cpu air/STARK/FRI/Decommitment/Layer 0/Virtual Oracle/Trace 0: For node 36892537: 
Hash(0x95778d4071a7c4094cc3001c93708f94af855023000000000000000000000000)"

// Value of the MerkleQueue in the extension trace
"/cpu air/STARK/FRI/Decommitment/Layer 0/Virtual Oracle/Trace 1: For node 18446268: 
Hash(0x697f9ba02cf0bb61cfc5e34eeaa2bbd388cad27e000000000000000000000000)"

// Value of the MerkleQueue in the extension trace
"/cpu air/STARK/FRI/Decommitment/Layer 0/Virtual Oracle/Trace 2: For node 36892537: 
Hash(0x3885ff625fe888d6d85c83c6b25f92c529bea7b1000000000000000000000000)"
```

```bash
// Value of the friQueue computed by the verifier in FRI (later converted to 
// Montgomery form in the proof)
"/cpu air/STARK/FRI/Decommitment/Layer 1: Row 834526, Column 1: 
Field Element(0x5c7307000a70b4bdffa0ef2257fccd83751dc6f8a2a1b5cec1eee7c2361c16b)"

// xInverse value computed by the verifier in FRI
"/cpu air/STARK/FRI/Decommitment/Layer 1: xInv for index 3338105: 
Field Element(0x14d3c0b43ec16caaeb1976510f0c3381a1d557ebc1ea5df20fb1b2b0ba2f478)"

// Next layer value computed by the verifier in FRI
"/cpu air/STARK/FRI/Decommitment/Layer 1: For node 9223134: Hash(0xaecfcc94ce7e90195568d30c1f71e7d83748480f000000000000000000000000)"
```

## Reference

- [Proof splitter - zkSecurity](https://zksecurity.github.io/stark-book/starkex/proof-splitter.html)
- [SHARP verifier smart contract - StarkNet](https://docs.starknet.io/architecture-and-concepts/solidity-verifier/)
- [Sandstorm - Andrew Milson](https://github.com/andrewmilson/sandstorm)
